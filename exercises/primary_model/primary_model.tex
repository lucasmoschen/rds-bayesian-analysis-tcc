\documentclass[a4paper, notitlepage, 11pt]{article}

%----------------------------------------------
%-------------------Style----------------------
%----------------------------------------------

\usepackage{geometry}
\fontfamily{times}
\geometry{verbose,tmargin=20mm,bmargin=25mm,lmargin=25mm,rmargin=25mm}

%----------------------------------------------
%-----------------Packages---------------------
%----------------------------------------------

% Writing 
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{lscape}
\fontfamily{times}
\usepackage[affil-it]{authblk}
\usepackage{lettrine}

% Graphics
\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx}
\graphicspath{{img/}}

% Math
\usepackage{amsthm, amssymb, amsmath, mathtools}

% Biblio
\usepackage[authoryear, round]{natbib}
\bibliographystyle{apalike}

%Others
\usepackage{url, hyperref}
\hypersetup{colorlinks=true,citecolor=blue}

%----------------------------------------------
%---------------Math definitions---------------
%----------------------------------------------

\newcommand{\R}{\mathbb{R}}
\newcommand{\x}{\boldsymbol{x}}
\newcommand{\N}{\operatorname{Normal}}
\newcommand{\betadist}{\operatorname{Beta}}

\newtheorem{theorem}{Theorem}[]
\newtheorem{proposition}{Proposition}[]

\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

\theoremstyle{remark}
\newtheorem*{remark}{Remark}
\newtheorem{assumption}{Assumption}

%----------------------------------------------
%-----------------Title Page-------------------
%----------------------------------------------

\title{Prevalence estimation}

\author{Lucas Machado Moschen}
\affil{School of Applied Mathematics, \\ Fundação Getulio Vargas}

\date{\today}

%----------------------------------------------
%------------------Document--------------------
%----------------------------------------------

\begin{document}
\maketitle

\section{Introduction}

A key question for epidemiologists and public health authorities is about the
proportion of individuals exposed to the disease at time $t$. This quantity
can be measured periodically, and the evolution shows how the transmission is
going on. For instance, if after a year the proportion grew 50\% it would be
worrisome. We call it prevalence. High prevalence of a disease within a
population might mean that there is a high incidence of it or prolonged
survival without cure. 

This report is the initial model for my bachelor dissertation entitled ``Bayesian analysis of respondent-driven surveys with
outcome uncertainty'', which proposes to study prevalence when the diagnostic
tests are imperfect and the population is hidden, that is, there is no
sampling frame for it \cite{heckathorn1997}. 

\subsection{Respondent-driven sampling}

RDS is commonly used to survey hidden or hard-to-reach populations when
no sampling frame exists \cite{heckathorn1997}. In this approach, the
researchers select some individuals, called {\em seeds} from the target
population, and give them a fixed amount of {\em recruitment coupons} to
recruit their peers. Each recipient of the coupons reclaims it in the study
site, is interviewed, and receives more coupons to continue the recruitment.
This process occurs until it reaches some criteria. The sampling is without
replacement, so the participants cannot be recruited more than once. Moreover,
the respondents inform their {\em network degree}.

The subjects receive a reward for being interviewed and for each recruitment
of their peers which establishes a dual system incentive. The {\em primary incentive} is the
{\em individual-sanction-based control}, so there is a reward for
participating. The second one is the {\em group-mediated social control} that
influences the participants to induce others to comply to get the reward for the recruitment. When social approval is important, recruitment can be even
more efficient and cheaper, since material incentive can be converted into
symbolic by the individuals. In summary, accepting to be recruited will have a
material incentive for both and a symbolic incentive for the recruited, since
theirs peers also participated.

Let $G = (V,E)$ be an undirected graph representing the hidden population. The {\em recruitment graph} $G_R =
(V_R, E_R)$ represents the recruited individuals and the recruitment edge.
Given that each individual can be sampled only once, it is not possible to
observe the {\em recruitment-induced subgraph}, that is the induced subgraph
generated by $V_R$. Moreover, the {\em coupon matrix} $C$ defined by $C_{ij} =
1$ if the i$^{th}$ subject has at least one coupon before the j$^{th}$
recruitment event, is also observed with the recruitment times. Assuming an
exponential and independent distribution of the times, the likelihood can be
written explicitly, and the distribution interpreted as an exponential random graph
model. 

These models allowed several applications in social sciences, epidemiology,
and statistics, including hidden populations size estimation
\cite{crawford2018hidden}, regression \cite{bastos2012binary}, communicable
disease prevalence estimation \cite{albuquerque2009avaliaccao}, among others.

\section{Preliminary definitions}

Suppose we have a sample indexed by $i$. Let $Y_i$ be the indicator
function of the $i^{th}$ individual's exposure to the disease, and $T_i$
indicating whether the test in the $i^{th}$ individual is positive at time
$t$. Suppose that $\{Y_i\}$ and $\{T_i\}$ are two independent and identically distributed
random variables with $\Pr(X = 1) = \theta$ and $\Pr(T = 1) = p$. We say that
$\theta$ is the prevalence and $p$ is the apparent prevalence in the
population. 

If the test is perfect, $T_i = Y_i$ for every $i$, and
$\theta = p$ (with probability one when they are random variables).
Unfortunately, this is not true in the real world, what makes important to
regard the evaluation of the diagnostic, and the following definitions are used:

\begin{definition}[Specificity]
  Probability of a negative test correctly identified. In mathematical terms,
  conditioned on $Y = 0$, the {\em specificity} $\gamma_e$ is the probability of $T = 0$: 
  \begin{equation}
    \gamma_e = \Pr(T = 0|Y = 0). 
  \end{equation} 
\end{definition}

\begin{definition}[Sensitivity]
  Probability of a positive test correctly identified. In mathematical terms,
  conditioned on $Y = 1$, the {\em sensitivity} $\gamma_s$ is the probability of $T = 1$: 
  \begin{equation}
    \gamma_s = \Pr(T = 1|Y = 1). 
  \end{equation} 
\end{definition}

\begin{theorem}[Relation between prevalence and apparent prevalence] These quantities are related by the following equation:
  \begin{equation}
    p = \gamma_s\theta + (1-\gamma_e)(1-\theta).
  \end{equation}
  
\end{theorem}

\begin{proof}
  This is a direct application of the definition of conditional probability
  and the countable additivity axiom of Probability:
  \begin{equation*}
    \begin{split}
      p &= \Pr(T = 1) = \Pr(T = 1, Y = 1) + \Pr(T = 1, Y = 0) \\
      &= \Pr(T=1|Y=1)\Pr(Y=1) + \Pr(T=1|Y=0)\Pr(Y=0) \\
      &= \Pr(T=1|Y=1)\Pr(Y=1) + (1 - \Pr(T=0|Y=0))(1-\Pr(Y=1)) \\
      &= \gamma_s\theta + (1 - \gamma_e)(1-\theta).
    \end{split}
  \end{equation*} 
\end{proof}

The intuition behind this equation is pretty simple: the proportion
of positive test counts the correct identified exposed individuals and the
incorrect identified not exposed. Observe that if $\gamma_s = \gamma_e = 1$, we have the trivial case $p =
\theta$. Moreover, if $\gamma_s = \gamma_e = 0.5$, we have that
$p = 0.5$ and there is no information about $\theta$. 

\begin{remark}
  Actually, we are interested in the pontual prevalence at time $t$. Being
  impossible to test every individual at the same time, we assume that all
  individuals remain exposed to the disease at time of the last tested individual. 
\end{remark}

\begin{definition}[Link function]
  A class of functions which maps a non-linear relationship to a linear one.
  Here we consider functions with domain $[0,1]$. Examples include the logit and probit
functions.
\end{definition}

\section{Prevalence model}

Firstly, we make some assumptions to simplify the modeling:

\begin{assumption}
  For a Bayesian modeling, we assume each parameter of the model
  has a probability distribution that incorporates the researcher's uncertainty about it. 
\end{assumption}

\begin{assumption}
  For each individual, we observe $k$ features that are possible
  risk factors represented by the vector $\x_i \in \R^{k+1}$ of the $i^{th}$ individual. The
  first component of $\x_i$ is 1 to handle the intercept term. 
\end{assumption}

\begin{assumption}
  Suppose that each individual has a probability $\theta_i$ of having been exposed
  to the disease that dependes on the prevalence $\theta$ and $\x_i$, not necessarily linearly.
  We therefore will have the probability of positive test $p_i$ in the
  $i^{th}$ individual. Therefore, the sequences $\{Y_i\}$ and $\{T_i\}$ are not
  identically distributed anymore.
\end{assumption} 

\begin{assumption}
  Sensitivity and specificity have the same distribution for all
  individuals and it only depends on the test used to diagnose. 
\end{assumption}

From above, we develop three different models with different stages.

\subsection{Perfect tests}

The first model only considers the risk factors $\x_i$. 

\begin{equation}
  \begin{aligned}
    T_i &\sim \operatorname{Bernoulli}(\theta_i), \\
    g(\theta_i) &= g(\theta) + \x_i\beta, 
  \end{aligned}  
\end{equation}
where $g(\cdot)$ is a link function. Note that $\theta_i = p_i$ for all $i$ in this case.
The parameter $\beta \in \R^{k+1}$ is the risk effects. For Bayesian inference, priors on
$\beta$ and $\theta$ must be included. We use $\beta ~ \sim \N(\mu, \Sigma)$
and $\theta \sim \betadist(\alpha^{p}, \beta^p)$, where $\mu
\in \R^{k+1}$, $\Sigma \in \R^{(k+1)\times(k+1)}$ symmetric positive-definite matrix,
$\alpha^p \in \R_{++}$, and $\beta^p \in \R_{++}$
are fixed hyperparameters. 

\subsubsection{Identifiability}

\subsection{Imperfect tests}

This model includes the sensitivity and specificity of the diagnostic test. 

\begin{equation}
  \begin{aligned}
    T_i &\sim \operatorname{Bernoulli}(p_i) \\
    p_i &= \gamma_s\theta_i + \gamma_e(1 - \theta_i),  \\
    g(\theta_i) &= g(\theta) + \x_i\beta,  \\
    \beta &\sim \N(\mu, \Sigma), \\ 
    \theta &\sim \betadist(\alpha^p, \beta^p) \\
    \gamma_s &\sim \betadist(\alpha^s, \beta^s), \\
    \gamma_e &\sim \betadist(\alpha^e, \beta^e), \\    
  \end{aligned}  
\end{equation}
where $\alpha^p, \alpha^s, \alpha^e, \beta^p, \beta^s, \beta^e \in \R_{++}$ are fixed hyperparameters.
This model does not include prior knowledge about the correlation between
specificity and sensitivity. 

\subsection{Imperfect test and respondent-driven sampling}

For now, we consider the network dependence induced by the RDS. Ideally, we 
should build a model for it and include the associated uncertainty.
Since it is not possible (for a while), we treat it as a random effect for
each individual. Conditionally autoregressive (CAR) models in the
Gaussian case are used. Therefore: 
\begin{equation}
  \begin{aligned}
    T_i &\sim \operatorname{Bernoulli}(p_i) \\
    p_i &= \gamma_s\theta_i + \gamma_e(1 - \theta_i),  \\
    g(\theta_i) &= g(\theta) + \x_i\beta + \omega_i,  \\
    \omega_i|\{\omega_j\}_{j\neq i}, \tau &\sim \N\left(\rho\sum_j b_{ij}\omega_j/b_{i+}, \tau^2/b_{i+}\right) \\
    \beta &\sim \N(\mu, \Sigma), \\ 
    \theta &\sim \betadist(\alpha^p, \beta^p) \\
    \gamma_s &\sim \betadist(\alpha^s, \beta^s), \\
    \gamma_e &\sim \betadist(\alpha^e, \beta^e), \\  
    \tau &\sim \N^+(0,\sigma^2_{\tau}),  
  \end{aligned}  
\end{equation}
such that $\rho$ is a fixed parameter in order to the distribution be proper, $[B]_{ij} = b_{ij}$ is a fixed matrix to measure the distance between $i$
and $j$, and $b_{i+} = \sum_{j} b_{ij}$. For instance, 
$$
b_{ij} = \begin{cases}
  1, &\text{if } i \text{ recruited } j \text{ or the contrary} \\
  0, &\text{otherwise.} 
\end{cases}
$$
RDS has the constraint of being without replacement. For that reason, we do
not observe all links among the samples \cite{crawford2016}. One way to handle
this is to use the model from Crawford to generate a posterior distribution to
$B$ as the adjacency matrix of the recruited subgraph. 


\section{Correlation analysis between specificity and sensitivity}

In this section, we shall describe how to use the Bivariate Beta
\cite{olkin2015constructions} to model the correlation between specificity and
sensitivity.

\bibliography{biblio} 

\end{document}          
